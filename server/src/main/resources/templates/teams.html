<!DOCTYPE html>
<html lang="ko" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8"/>
    <title>íŒ€ë¹Œë”© ê²°ê³¼</title>
    <meta name="viewport" content="width=device-width, initial-scale=1"/>

    <style>
        :root {
            --bg: #f7f8fa;
            --card: #fff;
            --text: #222;
            --muted: #6b7280;
            --accent: #2563eb;
            --chip: #eef2ff;
            --chip-text: #3730a3;
            --border: #e5e7eb;
        }

        body {
            margin: 0;
            font-family: system-ui, -apple-system, Segoe UI, Roboto, Apple SD Gothic Neo, 'Noto Sans KR', sans-serif;
            background: var(--bg);
            color: var(--text);
        }

        .container {
            max-width: 1080px;
            margin: 32px auto;
            padding: 0 16px;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: flex-start;
            margin-bottom: 20px;
        }

        .title-section {
            flex: 1;
        }

        .page-title {
            font-size: 28px;
            font-weight: 800;
            margin-bottom: 6px;
        }

        .sub {
            color: var(--muted);
            font-size: 14px;
            margin-bottom: 0;
        }

        .back-btn {
            padding: 10px 16px;
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 10px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            color: var(--text);
            text-decoration: none;
            display: flex;
            align-items: center;
            gap: 6px;
            transition: all 0.2s ease;
            min-width: 80px;
            justify-content: center;
        }

        .back-btn:hover {
            border-color: var(--accent);
            color: var(--accent);
            background: #fafafa;
        }

        .back-btn:active {
            transform: translateY(1px);
        }

        .toolbar {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 12px;
            align-items: center;
            margin-bottom: 16px;
        }

        .search {
            display: flex;
            gap: 8px;
        }

        .search input {
            flex: 1;
            padding: 10px 12px;
            border: 1px solid var(--border);
            border-radius: 10px;
            font-size: 14px;
        }

        .search-help {
            color: var(--muted);
            font-size: 12px;
            margin-top: 4px;
        }

        .sorts {
            display: flex;
            gap: 8px;
        }

        .btn {
            padding: 9px 12px;
            border: 1px solid var(--border);
            background: var(--card);
            border-radius: 10px;
            font-size: 14px;
            cursor: pointer;
        }

        .btn:hover {
            border-color: var(--accent);
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(1, minmax(0, 1fr));
            gap: 14px;
        }

        @media (min-width: 760px) {
            .grid {
                grid-template-columns: repeat(2, minmax(0, 1fr));
            }
        }

        .section-title {
            font-size: 20px;
            font-weight: 800;
            margin: 28px 0 12px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .section-sub {
            color: var(--muted);
            font-size: 13px;
            margin-bottom: 10px;
        }

        .card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 14px;
            padding: 14px;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }

        .card-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 8px;
        }

        .team-name {
            font-size: 18px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .badge {
            background: var(--chip);
            color: var(--chip-text);
            font-size: 11px;
            padding: 3px 8px;
            border-radius: 999px;
        }

        .muted {
            color: var(--muted);
            font-size: 12px;
        }

        .leader {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .pill {
            display: inline-flex;
            align-items: center;
            gap: 6px;
            padding: 6px 10px;
            border-radius: 999px;
            background: #f3f4f6;
            font-size: 13px;
        }

        .members {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .chip {
            background: #f9fafb;
            border: 1px solid var(--border);
            border-radius: 999px;
            padding: 6px 10px;
            font-size: 13px;
        }

        .footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .actions {
            display: flex;
            gap: 8px;
        }

        .copy {
            border-color: var(--accent);
            color: var(--accent);
        }

        .empty {
            text-align: center;
            padding: 48px 16px;
            color: var(--muted);
            border: 1px dashed var(--border);
            border-radius: 14px;
            background: #fff;
        }

        /* ëª¨ë°”ì¼ì—ì„œ í—¤ë” ë ˆì´ì•„ì›ƒ ì¡°ì • */
        @media (max-width: 640px) {
            .header {
                flex-direction: column;
                gap: 12px;
            }

            .back-btn {
                align-self: flex-end;
            }
        }
    </style>
</head>
<body>
<div class="container">
    <div class="header">
        <div class="title-section">
            <div class="page-title">íŒ€ë¹Œë”© ê²°ê³¼</div>
            <div class="sub">
                ì´ <b th:text="${#lists.size(teams.getResults())}">0</b>ê°œ íŒ€
            </div>
        </div>
        <button class="back-btn" onclick="goBack()">â† ëŒì•„ê°€ê¸°</button>
    </div>

    <div class="toolbar">
        <div>
            <div class="search">
                <input id="q" type="text" placeholder="íŒ€ëª…/íŒ€ì¥/íŒ€ì›/ë¯¸ë°°ì • ê²€ìƒ‰â€¦" oninput="filterCards()"/>
                <button class="btn" onclick="clearSearch()">ì§€ìš°ê¸°</button>
            </div>
            <div class="search-help">ì˜ˆ) "ì•ŒíŒŒ", "ê¹€ê°œë°œ", "FRONTEND", "í™ê¸¸ë™" ê°™ì´ ê²€ìƒ‰í•  ìˆ˜ ìˆì–´ìš”.</div>
        </div>
        <div class="sorts">
            <button class="btn" onclick="sortByName()">íŒ€ëª…ìˆœ</button>
            <button class="btn" onclick="sortBySize()">íŒ€ì›ìˆ˜ìˆœ</button>
        </div>
    </div>

    <div th:if="${#lists.isEmpty(teams.getResults())}" class="empty">
        ì•„ì§ íŒ€ ê²°ê³¼ê°€ ì—†ì–´ìš”. íŒ€ë¹Œë”©ì„ ì™„ë£Œí•˜ë©´ ì—¬ê¸°ì—ì„œ í™•ì¸í•  ìˆ˜ ìˆì–´ìš”.
    </div>

    <div id="grid" class="grid" th:if="${!#lists.isEmpty(teams.getResults())}">
        <!-- íŒ€ ì¹´ë“œ -->
        <div class="card"
             th:each="team : ${teams.getResults()}"
             th:attr="data-key=|${team.teamName} ${team.leader.name} ${#strings.listJoin(team.members.![#this.name], ' ')} ${team.leader.position} ${#strings.listJoin(team.members.![#this.position], ' ')}|">
            <div class="card-header">
                <div class="team-name">
                    <span th:text="${team.teamName}">ì•ŒíŒŒ</span>
                    <span class="badge" th:text="'ë©¤ë²„ ' + ${#lists.size(team.members)} + 'ëª…'">ë©¤ë²„ 0ëª…</span>
                </div>
                <div class="muted" th:text="'ID #' + ${team.projectId}">ID #0</div>
            </div>

            <div class="leader">
                <div class="pill">
                    <strong>íŒ€ì¥</strong>
                    <span th:text="${team.leader.name}">ê¹€ê°œë°œ</span>
                    <span class="muted" th:if="${team.leader.position != null}"
                          th:text="'Â· ' + ${team.leader.position}">Â· BACKEND</span>
                </div>
            </div>

            <div>
                <div class="muted" style="margin-bottom:6px;">íŒ€ì›</div>
                <div class="members">
                  <span class="chip" th:each="m : ${team.members}">
                    <span th:text="${m.name}">ì´í”„ë¡ </span>
                    <span class="muted" th:if="${m.position != null}" th:text="'Â· ' + ${m.position}">Â· FRONTEND</span>
                  </span>
                </div>
            </div>

            <div th:if="${team.summary != null}" class="muted" th:text="${team.summary}">ì„¤ëª…/ë¹„ê³ </div>

            <!-- ë³µì‚¬ìš© ìˆ¨ê¹€ í…ìŠ¤íŠ¸ -->
            <div class="rosterText" style="display:none;">
                <span th:text="'íŒ€ëª…: ' + ${team.teamName}"></span>
                <span> / </span>
                <span th:text="'íŒ€ì¥: ' + ${team.leader.name} + (${team.leader.position} != null ? 'Â·' + ${team.leader.position} : '')"></span>
                <span> / íŒ€ì›: </span>
                <span th:each="m, stat : ${team.members}">
                    <span th:text="${m.name} + (${m.position} != null ? 'Â·' + ${m.position} : '')"></span>
                    <span th:if="${!stat.last}">, </span>
                </span>
            </div>

            <div class="footer">
                <div class="muted">
                    ì´ ì¸ì›: <b th:text="${1 + #lists.size(team.members)}">0</b>ëª… (íŒ€ì¥ í¬í•¨)
                </div>
                <div class="actions">
                    <button class="btn copy" onclick="copyRoster(this)">ëª…ë‹¨ ë³µì‚¬</button>
                </div>
            </div>
        </div>
    </div>

    <!-- â–¼â–¼ ë¯¸ë°°ì • ì§€ì›ì ì„¹ì…˜ â–¼â–¼ -->
    <div class="section-title">ë¯¸ë°°ì • ì§€ì›ì</div>
    <div class="section-sub">
        ì´ <b th:text="${unassigned != null ? #lists.size(unassigned) : 0}">0</b>ëª…
    </div>

    <div th:if="${unassigned == null || #lists.isEmpty(unassigned)}" class="empty">
        ëª¨ë“  ì§€ì›ìê°€ íŒ€ì— ë°°ì •ë˜ì—ˆìŠµë‹ˆë‹¤ ğŸ‰
    </div>

    <div id="unassignedGrid" class="grid" th:if="${unassigned != null && !#lists.isEmpty(unassigned)}">
        <div class="card"
             th:each="m : ${unassigned}"
             th:attr="data-key=|${m.name} ${m.position} ë¯¸ë°°ì •|">
            <div class="card-header">
                <div class="team-name">
                    <span th:text="${m.name}">í™ê¸¸ë™</span>
                    <span class="badge" th:text="${m.position}">FRONTEND</span>
                </div>
                <div class="muted">ë¯¸ë°°ì •</div>
            </div>
        </div>
    </div>
    <!-- â–²â–² ë¯¸ë°°ì • ì§€ì›ì ì„¹ì…˜ â–²â–² -->
</div>

<script>
    function goBack() {
        window.history.go(-2);
    }

    // ê²€ìƒ‰: íŒ€ ì¹´ë“œ + ë¯¸ë°°ì • ì¹´ë“œ ë™ì‹œ í•„í„°
    function filterCards() {
        const q = document.getElementById('q').value.trim().toLowerCase();
        const cards = document.querySelectorAll('#grid .card, #unassignedGrid .card');
        cards.forEach(card => {
            const key = (card.getAttribute('data-key') || '').toLowerCase();
            card.style.display = key.includes(q) ? '' : 'none';
        });
    }

    function clearSearch() {
        const input = document.getElementById('q');
        input.value = '';
        filterCards();
        input.focus();
    }

    // ì •ë ¬: íŒ€ ì¹´ë“œë§Œ (ë¯¸ë°°ì •ì€ ì •ë ¬ ëŒ€ìƒ ì•„ë‹˜)
    function sortByName() {
        sortCards((a, b) => {
            const an = a.querySelector('.team-name span').innerText.trim();
            const bn = b.querySelector('.team-name span').innerText.trim();
            return an.localeCompare(bn, 'ko');
        });
    }

    function sortBySize() {
        sortCards((a, b) => getMemberSize(b) - getMemberSize(a));
    }

    function getMemberSize(card) {
        const badge = card.querySelector('.badge');
        if (!badge) return 0;
        const m = badge.innerText.match(/ë©¤ë²„\s+(\d+)/);
        return m ? parseInt(m[1], 10) : 0;
    }

    function sortCards(comparator) {
        const grid = document.getElementById('grid');
        if (!grid) return;
        const cards = Array.from(grid.children);
        cards.sort(comparator).forEach(c => grid.appendChild(c));
    }

    function copyRoster(btn) {
        const card = btn.closest('.card');
        const text = card.querySelector('.rosterText').innerText.trim();
        if (navigator.clipboard && window.isSecureContext) {
            navigator.clipboard.writeText(text).then(() => flash(btn));
        } else {
            const ta = document.createElement('textarea');
            ta.value = text;
            document.body.appendChild(ta);
            ta.select();
            try {
                document.execCommand('copy');
                flash(btn);
            } finally {
                document.body.removeChild(ta);
            }
        }
    }

    function flash(btn) {
        const orig = btn.innerText;
        btn.innerText = 'ë³µì‚¬ë¨!';
        setTimeout(() => btn.innerText = orig, 900);
    }
</script>
</body>
</html>